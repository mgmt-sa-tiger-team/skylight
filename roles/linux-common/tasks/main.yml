---
- name: Install packages
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - NetworkManager

- name: create dhclient.conf
  file:
    path: /etc/dhcp/dhclient.conf
    state: touch
    owner: root
    group: root
    mode: '0644'

- name: set custom DNS server
  blockinfile:
    dest: /etc/dhcp/dhclient.conf
    block: |
      prepend domain-name-servers {{ hostvars['windc']['private_ip'] }};
      prepend domain-search "{{ dns_domain_name }}", "ec2.internal";
    state: present
  register: dnschange

- name: restart NetworkManager
  service:
    name: NetworkManager
    state: restarted
  when: dnschange.changed or etchost.changed

- name: Add EPEL repo
  yum_repository:
    name: epel
    description: EPEL for Enterprise Linux 7
    baseurl: https://dl.fedoraproject.org/pub/epel/7/x86_64/
    enabled: yes
    gpgcheck: no

- name: Install packages
  package:
    name:
      - vim
      - bind-utils
    state: present



